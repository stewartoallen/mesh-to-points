# Project Structure

## Directory Layout

```
stl-to-mesh/
├── src/                    # Source code
│   ├── wasm/              # C/WASM source files
│   │   ├── mesh-converter-lib.c      # Core algorithm
│   │   ├── mesh-converter-lib.h      # Header file
│   │   └── mesh-converter.c          # WASM wrapper
│   ├── web/               # Web application files
│   │   ├── index.html                # Main HTML
│   │   ├── style.css                 # Styles
│   │   ├── app.js                    # Three.js app
│   │   └── worker.js                 # Web Worker
│   └── test/              # Test harnesses
│       ├── test-converter-new.c      # Native C test
│       └── test-wasm.cjs             # WASM test (Node.js)
├── build/                 # Build output (gitignored)
│   ├── mesh-converter.wasm           # Compiled WASM
│   ├── index.html                    # Copied from src/web
│   ├── style.css
│   ├── app.js
│   └── worker.js
├── benchmark/             # Performance testing
│   ├── fixtures/
│   │   └── inner.stl                 # Test STL file
│   ├── versions/                     # Algorithm version backups
│   │   ├── mesh-converter-lib-v1.0-backface.c
│   │   ├── mesh-converter-lib-v1.1-closest-hit.c
│   │   └── mesh-converter-lib-v1.2-xy-grid.c
│   └── validate-optimizations.sh     # Validation script
├── notes/                 # Documentation
│   └── *.md                          # Various documentation files
├── package.json           # NPM scripts and config
├── .gitignore             # Git ignore rules
└── README.md              # Main documentation
```

## NPM Scripts

### Build Commands

```bash
# Clean build artifacts
npm run clean

# Build WASM only
npm run build:wasm

# Copy web files to build/
npm run build:web

# Full build (WASM + web files)
npm run build
```

### Test Commands

```bash
# Run native C test (fast, direct compilation)
npm run test:native

# Run WASM test (via Node.js)
npm run test:wasm

# Run both tests
npm test
```

### Development Commands

```bash
# Build and start dev server
npm run dev

# Just serve (assumes already built)
npm run serve
```

### Validation

```bash
# Run optimization validation (compares v1.0 vs v1.2)
npm run validate
```

## Build Process

1. **Clean**: Removes `build/` directory and test binaries
2. **WASM Compilation**: Compiles `src/wasm/mesh-converter.c` → `build/mesh-converter.wasm`
3. **Web Files**: Copies `src/web/*` → `build/`
4. **Result**: Complete application in `build/` directory

## Testing Workflow

### Native Testing (Fastest)
```bash
npm run test:native
```
- Compiles C directly with gcc
- Links with `mesh-converter-lib.c`
- Tests with `benchmark/fixtures/inner.stl`
- ~0.086s execution time
- Great for rapid iteration

### WASM Testing
```bash
npm run test:wasm
```
- Builds WASM module
- Runs test via Node.js
- Validates WASM interface
- ~0.14s execution time
- Confirms browser will work

### Full Test Suite
```bash
npm test
```
Runs both native and WASM tests

## Development Workflow

### Initial Setup
```bash
npm install
npm run build
```

### Making Changes

**To C/WASM code:**
1. Edit `src/wasm/mesh-converter-lib.c`
2. Run `npm run test:native` (quick feedback)
3. Run `npm run build` (rebuild WASM)
4. Run `npm run serve` (test in browser)

**To web code (HTML/CSS/JS):**
1. Edit files in `src/web/`
2. Run `npm run build:web` (just copy files)
3. Refresh browser

**Quick iteration:**
```bash
# Terminal 1: Watch mode (manual for now)
npm run build:web && npm run serve

# Terminal 2: Make changes, then
npm run build:web
# Refresh browser
```

## File Organization Principles

### Source (`src/`)
- **Editable files only**
- Organized by language/type
- Version controlled

### Build (`build/`)
- **Generated files only**
- Gitignored
- Can be deleted and rebuilt

### Benchmark (`benchmark/`)
- Test fixtures (STL files)
- Version backups for comparison
- Validation scripts
- Not modified during development

### Notes (`notes/`)
- Documentation
- Session summaries
- Optimization analysis
- Version controlled

## gitignore Rules

Ignored:
- `build/` - Regenerated by build process
- `*.wasm` - Compiled artifacts
- `test-converter*` - Test binaries
- `node_modules/` - NPM dependencies
- `.DS_Store` - OS files

Tracked:
- All source code (`src/`)
- Documentation (`notes/`, `*.md`)
- Benchmark files (`benchmark/`)
- Configuration (`package.json`, `.gitignore`)

## Adding New Files

### New WASM Code
- Add to `src/wasm/`
- Update `mesh-converter.c` if needed
- Rebuild with `npm run build:wasm`

### New Web Code
- Add to `src/web/`
- Reference in `index.html`
- Copy with `npm run build:web`

### New Tests
- Add to `src/test/`
- Update package.json scripts if needed

### New Documentation
- Add to `notes/`
- Link from README if important

## Migration from Flat Structure

Files were moved as follows:
- `*.c`, `*.h` → `src/wasm/`
- `*.html`, `*.css`, `app.js`, `worker.js` → `src/web/`
- `test-*.c`, `test-*.js` → `src/test/`
- `inner.stl` → `benchmark/fixtures/`
- `*-v1.*.c` → `benchmark/versions/`
- `*.md` (except README) → `notes/`

All paths in source files updated accordingly.
